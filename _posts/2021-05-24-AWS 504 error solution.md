---

title:  "AWS 504 에러"

search: true
categories: 
  - AWS management diary
---



# AWS 504 문제

먼저 504가 무엇인지  알아야 한다. 

504는 http에서 타임아웃이 발생한 경우에 생기는 오류이다. 

그럼 생각해 볼수 있는 경우가 네트워크 단에서 잘못된 경로를 향하던가 아님 응용 프로그램에서 답을 못하거나 할 수 도 있다.(사실 다 찾아봐야 정확히 알 수가 있다. 

위키트리에서는 아래의 내용으로 설명을 한다. 

504(게이트웨이 시간초과): 서버가 게이트웨이나 프록시 역할을 하고 있거나 또는 업스트림 서버에서 제때 요청을 받지 못했다. 

아무튼 보통 에러가 발생하는 경우는 웹 브라우저에서 504가 뜬 것을 확인 할수 있는데 이게 web서버에서 난건지 Was에서 난건지 도통 알 수가 없다. 

왜냐면 아키텍처가 어떻게 구성되었는지에 따라 확인해야할게 다르기 때문이다.

필자가 운영하는 서비스의 아키텍처는 이중화가 된 WEB, WAS, DB가 있는 3 tier 형태이다.

그리고 3 tier의 계층들 사이는 로드밸런스가 있다. 

그럼 어디를 먼저 볼 것인지를 선택해야 한다. 힌트는 에러의 종류이다. 

5XX나 4XX같은 문제는 로드밸런스를 먼저 살펴야 한다. 실제로 CloudWatch 모니터링을 보면 ALB관련한 지표 중에 5XX나 4XX가 있다. 

모니터링에서 어디 타겟 그룹인지 어디 서버인지 확인을 해야 한다.

필자는 아파치 Keepalive 시간이 AWS 로드밸런서 유휴시간보다 짧은 것이 원인인 것을 확인했다.